\mode<presentation>

% Square items
\setbeamertemplate{sections/subsections in toc}[square]
\setbeamertemplate{items}[square]

\def\backgroundimage{
  \begin{tikzpicture}[overlay,remember picture]
    \node[at=(current page.center),fill=nhhblue, minimum width=\paperwidth, minimum height=\paperheight] {}; % !100!supportcoolgray2
    \coordinate (SE_corner) at ($(current page.south east) + (-\gridcellwidth - \gridsepwidth, \gridcellwidth + \gridsepwidth)$);
    \coordinate (NE_corner) at ($(current page.north east) + (-\gridcellwidth - \gridsepwidth, - \gridcellwidth - \gridsepwidth)$);

    \coordinate (N) at (0, \gridcellwidth);
    \coordinate (Ni) at (0, \gridcellwidth + \gridsepwidth);
    \coordinate (E) at (\gridcellwidth, 0);
    \coordinate (Ei) at (\gridcellwidth + \gridsepwidth, 0);

    % \node[anchor=south east, inner sep=0pt, opacity=0.2] at (SE_corner) {\pgfuseimage{nhh-diamonds}}; % 
    \node[anchor=north east, inner sep=0pt] at (NE_corner) {\pgfuseimage{nhh-logo-upright-gold-large}};

    \coordinate (start) at ($(SE_corner) - (5*\gridsepwidth + 6*\gridcellwidth, 0)$);

    % Opacity gradings based on L1 distance from south east corner.
    \pgfmathsetmacro{\d}{1.0}
    \pgfmathsetmacro{\dd}{0.85}
    \pgfmathsetmacro{\ddd}{0.7}
    \pgfmathsetmacro{\dddd}{0.55}
    \pgfmathsetmacro{\ddddd}{0.4}
    \pgfmathsetmacro{\dddddd}{0.25}

    %Row 1
    \draw [fill=nhhbluesecondary, draw=none, opacity=\dddddd] (start) -- ($(start) + (E)$) -- ($(start) + (E) + (N)$) -- cycle;
    \draw [fill=nhhbluesecondary, draw=none, opacity=\ddddd] ($(start) + (Ei)$) -- ($(start) + (Ei) + (N)$) -- ($(start) + (Ei) + (E)$) -- cycle;
    \draw [fill=nhhbluesecondary, draw=none, opacity=\dddd] ($(start) + 2*(Ei)$) -- ($(start) + 2*(Ei) + (N)$) -- ($(start) + 2*(Ei) + (E) + (N)$) -- cycle;
    \draw [fill=nhhbluesecondary, draw=none, opacity=\ddd] ($(start) + 3*(Ei)$) -- ($(start) + 3*(Ei) + (N)$) -- ($(start) + 3*(Ei) + (E)$) -- cycle;
    \draw [fill=nhhbluesecondary, draw=none, opacity=\d] ($(start) + 5*(Ei)$) -- ($(start) + 5*(Ei) + (N)$) -- ($(start) + 5*(Ei) + (E)$) -- cycle;
	
    %Row 2
    \draw [fill=nhhbluesecondary, draw=none, opacity=\dddddd] ($(start) + (Ni) + (Ei) + (N)$) -- ($(start) + (Ni) + (Ei) + (N) + (E)$) -- ($(start) + (Ei) + (Ni) + (E)$) -- cycle;
    \draw [fill=nhhbluesecondary, draw=none, opacity=\ddddd] ($(start) + (Ni) + 2*(Ei)$) -- ($(start) + (Ni) + 2*(Ei) + (N)$) -- ($(start) + (Ni) + 2*(Ei) + (E)$) -- cycle;
    \draw [fill=nhhbluesecondary, draw=none, opacity=\ddd] ($(start) + (Ni) + 4*(Ei)$) -- ($(start) + (Ni) + 4*(Ei) + (N)$) -- ($(start) + (Ni) + 4*(Ei) + (E)$) -- cycle; 
    \draw [fill=nhhbluesecondary, draw=none, opacity=\dd] ($(start) + (Ni) + 5*(Ei)$) -- ($(start) + (Ni) + 5*(Ei) + (N) + (E)$) -- ($(start) + (Ni) + 5*(Ei) + (E)$) -- cycle;
 
    %Row 3
  	\draw [fill=nhhbluesecondary, draw=none, opacity=\dddddd] ($(start) + 2*(Ni) + 2*(Ei)$) -- ($(start) + 2*(Ni) + 2*(Ei) + (N)$) -- ($(start) + 2*(Ni) + 2*(Ei) + (E)$) -- cycle;
   	\draw [fill=nhhbluesecondary, draw=none, opacity=\ddddd] ($(start) + 2*(Ni) + 3*(Ei) + (N)$) -- ($(start) + 2*(Ni) + 3*(Ei) + (N) + (E)$) -- ($(start) + 3*(Ei) + 2*(Ni) + (E)$) -- cycle;
   	\draw [fill=nhhbluesecondary, draw=none, opacity=\ddd] ($(start) + 2*(Ni) + 5*(Ei) + (N)$) -- ($(start) + 2*(Ni) + 5*(Ei) + (N) + (E)$) -- ($(start) + 5*(Ei) + 2*(Ni) + (E)$) -- cycle;
   
   	%Row 4
    \draw [fill=nhhbluesecondary, draw=none, opacity=\dddddd] ($(start) + 3*(Ni) + 3*(Ei)$) -- ($(start) + 3*(Ni) + 3*(Ei) + (N) + (E)$) -- ($(start) + 3*(Ni) + 3*(Ei) + (E)$) -- cycle;
   	\draw [fill=nhhbluesecondary, draw=none, opacity=\ddddd] ($(start) + 3*(Ni) + 4*(Ei)$) -- ($(start) + 3*(Ni) + 4*(Ei) + (N) + (E)$) -- ($(start) + 3*(Ni) + 4*(Ei) + (E)$) -- cycle;
  	\draw [fill=nhhbluesecondary, draw=none, opacity=\dddd] ($(start) + 3*(Ni) + 5*(Ei)$) -- ($(start) + 3*(Ni) + 5*(Ei) + (N)$) -- ($(start) + 3*(Ni) + 5*(Ei) + (E) + (N)$) -- cycle;
   
   	%Row 5
   	\draw [fill=nhhbluesecondary, draw=none, opacity=\ddddd] ($(start) + 4*(Ni) + 5*(Ei)$) -- ($(start) + 4*(Ni) + 5*(Ei) + (N)$) -- ($(start) + 4*(Ni) + 5*(Ei) + (E)$) -- cycle;
 
  \end{tikzpicture}
}

% Title page
\defbeamertemplate*{title page}{nhh}[1][]
{
  \setbeamertemplate*{background}{\backgroundimage}
  \vbox{}
  % \vskip0.21\paperheight
  \vfill
  \begingroup
    \begin{columns}[c]
      \begin{column}{\beamer@leftmargin}
        \ifx\insertsubtitle\@empty%
          \usebeamerfont{title}\usebeamercolor[bg]{column separator}\hfill\rule{0.8ex}{3em}
        \else%
          \usebeamerfont{title}\usebeamercolor[bg]{column separator}\hfill\rule{0.8ex}{5em}
        \fi%  
      \end{column}
      \begin{column}{\paperwidth-\beamer@leftmargin}
        \begin{beamercolorbox}[sep=1em,left,wd={\titlewidth},#1]{title in title page}
          \usebeamerfont{title}\inserttitle\par%
          \ifx\insertsubtitle\@empty%
          \else%
            \vskip0.25em%
            {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
          \fi%     
        \end{beamercolorbox}%
      \end{column}
    \end{columns} 
    \vskip1em\par
    \begin{beamercolorbox}[sep=8pt,left,wd={\titlepageinfowidth},#1]{author}
      \usebeamerfont{author}\insertauthor
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,left,wd={\titlepageinfowidth},#1]{institute}
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,left,wd=\titlepageinfowidth,#1]{date}
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}\vskip0.5em
    \begin{beamercolorbox}[sep=8pt,left,wd=\titlepageinfowidth]{titlegraphic}
      \usebeamerfont{titlegraphic}\inserttitlegraphic
    \end{beamercolorbox}
  \endgroup
  \vfill
}

% Part page: nhh
\defbeamertemplate*{part page}{nhh}[1][]
{
  \setbeamertemplate*{background}{\backgroundimage}
  \begingroup
    \centering
    {\usebeamerfont{part name}\usebeamercolor[fg]{part name}\partname~\insertromanpartnumber}
    \vskip1em\par
    \begin{beamercolorbox}[sep=16pt,center,#1]{part title}
      \usebeamerfont{part title}\insertpart\par
    \end{beamercolorbox}
  \endgroup
}

% Section page: nhh
\defbeamertemplate*{section page}{nhh}[1][]
{
  \setbeamertemplate*{background}{\backgroundimage}
  \begingroup
    \centering
      \begin{columns}[c]
      \begin{column}{\beamer@leftmargin}
        \usebeamerfont{section title}\usebeamercolor[bg]{column separator}\hfill\rule{0.8ex}{3em}
      \end{column}
      \begin{column}{\paperwidth-\beamer@leftmargin}
      \begin{beamercolorbox}[sep=1em,wd=\titlewidth,left,#1]{section title in section page}
          \usebeamerfont{section title}\insertsection\par
      \end{beamercolorbox} 
      \end{column}
      \end{columns}
  \endgroup
}

% Final page
\defbeamertemplate*{final text}{nhh}{Thank you!}

\defbeamertemplate*{final page}{nhh}[1][]
{
  \setbeamertemplate*{background}{\backgroundimage}
  \begingroup
    \centering
      \begin{columns}[T]
        \begin{column}{6pt}
          \usebeamercolor[bg]{column separator}\rule{1ex}{3em}
        \end{column}
        \begin{column}{\linewidth}
          \begin{beamercolorbox}[sep=12pt,left,#1]{section title in section page}
              \usebeamerfont{section title}\usebeamertemplate*{final text}\par
          \end{beamercolorbox}
        \end{column}
      \end{columns}
  \endgroup
}

\def\finalpage{\usebeamertemplate*{final page}\@thanks}

\mode<all>