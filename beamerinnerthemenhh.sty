\mode<presentation>

% Square items
\setbeamertemplate{sections/subsections in toc}[square]
\setbeamertemplate{items}[square]

% \pgfdeclareimage[height=0.9\paperheight]{nhh-diamonds}{NHH_additional/Asset4diamanter_fliplr.png}
\pgfdeclareimage[height=0.5\paperheight]{nhh-diamonds}{NHH_additional/Asset4diamanter_fliplr_crop_colorcorr.png}


% \pgfdeclareimage[height=0.3\paperheight]{nhh-diamonds}{NHH_additional/1Asset1diamanter.png}

\newlength{\gridwdth}
\setlength{\gridwdth}{0.05\paperwidth}

\newlength{\gridsep}
\setlength{\gridsep}{0.0015\paperwidth}

\def\backgroundimage{
  \begin{tikzpicture}[overlay,remember picture]
    \node[at=(current page.center),fill=nhhblue, minimum width=\paperwidth, minimum height=\paperheight] {}; % !100!supportcoolgray2
    \coordinate (SE_corner) at ($(current page.south east) + (-\gridwdth, +\gridwdth)$) {};
    \coordinate (NE_corner) at ($(current page.north east) + (-\gridwdth, -\gridwdth)$) {};

    \coordinate (N) at (0, \gridwdth);
    \coordinate (Ni) at (0, \gridwdth + \gridsep);
    \coordinate (E) at (\gridwdth, 0);
    \coordinate (Ei) at (\gridwdth + \gridsep, 0);

    % \node[anchor=south east, inner sep=0pt, opacity=0.2] at (SE_corner) {\pgfuseimage{nhh-diamonds}}; % 
    \node[anchor=north east, inner sep=0pt] at (NE_corner) {\pgfuseimage{nhh-logo-upright-gold-large}};

    \coordinate (start) at ($(SE_corner) - 6*(E)$);

    %Row 1  
    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] (start) -- ($(start) + (E)$) -- ($(start) + (E) + (N)$) -- cycle;
    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] ($(start) + (Ei)$) -- ($(start) + (Ei) + (N)$) -- ($(start) + (Ei) + (E)$) -- cycle;
    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] ($(start) + 2*(Ei)$) -- ($(start) + 2*(Ei) + (N)$) -- ($(start) + 2*(Ei) + (E) + (N)$) -- cycle;
    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] ($(start) + 3*(Ei)$) -- ($(start) + 3*(Ei) + (N)$) -- ($(start) + 3*(Ei) + (E)$) -- cycle;
    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] ($(start) + 5*(Ei)$) -- ($(start) + 5*(Ei) + (N)$) -- ($(start) + 5*(Ei) + (E)$) -- cycle;

    %Row 2
    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] ($(start) + (Ei) + (Ni) + (N)$) -- ($(start) + (Ei) + (Ni) + (N) + (E)$) -- ($(start) + (Ei) + (Ni) + (E)$) -- cycle;
    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] ($(start) + (Ni) + 2*(Ei)$) -- ($(start) + (Ni) + 2*(Ei) + (N)$) -- ($(start) + (Ni) + 2*(Ei) + (E)$) -- cycle;

    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] ($(start) + (Ni) + 4*(Ei)$) -- ($(start) + (Ni) + 4*(Ei) + (N)$) -- ($(start) + (Ni) + 4*(Ei) + (E)$) -- cycle;
    
    \draw [fill=nhhbluesecondary!60!nhhblue, draw=none] ($(start) + (Ni) + 5*(Ei)$) -- ($(start) + (Ni) + 5*(Ei) + (N)$) -- ($(start) + (Ni) + 5*(Ei) + (E)$) -- cycle;
  \end{tikzpicture}
}

% Title page
\defbeamertemplate*{title page}{nhh}[1][]
{
  \setbeamertemplate*{background}{\backgroundimage}
  \vbox{}
  \vskip0.21\paperheight
  \vfill
  \begingroup
    \begin{columns}
      \begin{column}{6pt}
        \ifx\insertsubtitle\@empty%
          \usebeamerfont{title}\usebeamercolor[bg]{column separator}\rule{6pt}{2em}
        \else%
          \usebeamerfont{title}\usebeamercolor[bg]{column separator}\rule{6pt}{4em}
        \fi%  
      \end{column}
      \begin{column}{\textwidth}
        \begin{beamercolorbox}[sep=8pt,left,#1]{title in title page}
          \usebeamerfont{title}\inserttitle\par%
          \ifx\insertsubtitle\@empty%
          \else%
            \vskip0.25em%
            {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
          \fi%     
        \end{beamercolorbox}%
      \end{column}
    \end{columns} 
    \vskip1em\par
    \begin{beamercolorbox}[sep=8pt,left,#1]{author}
      \usebeamerfont{author}\insertauthor
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,left,#1]{institute}
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,left,#1]{date}
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}\vskip0.5em
    \begin{beamercolorbox}[sep=8pt,left]{titlegraphic}
      \inserttitlegraphic
    \end{beamercolorbox}
  \endgroup
  \vfill
}

% Part page: nhh
\defbeamertemplate*{part page}{nhh}[1][]
{
  \setbeamertemplate*{background}{\backgroundimage}
  \begingroup
    \centering
    {\usebeamerfont{part name}\usebeamercolor[fg]{part name}\partname~\insertromanpartnumber}
    \vskip1em\par
    \begin{beamercolorbox}[sep=16pt,center,#1]{part title}
      \usebeamerfont{part title}\insertpart\par
    \end{beamercolorbox}
  \endgroup
}

% Section page: nhh
\defbeamertemplate*{section page}{nhh}[1][]
{
  \setbeamertemplate*{background}{\backgroundimage}
  \begingroup
    \centering
      \begin{columns}
      \begin{column}{6pt}
        \usebeamerfont{section title}\usebeamercolor[bg]{column separator}\rule{1ex}{2em}
      \end{column}
      \begin{column}{\linewidth}
      \begin{beamercolorbox}[sep=12pt,left,#1]{section title in section page}
          \usebeamerfont{section title}\insertsection\par
      \end{beamercolorbox} 
      \end{column}
      \end{columns}
  \endgroup
}

% Final page
\defbeamertemplate*{final text}{nhh}{Thank you!}

\defbeamertemplate*{final page}{nhh}[1][]
{
  \setbeamertemplate*{background}{\backgroundimage}
  \begingroup
    \centering
      \begin{columns}[T]
        \begin{column}{6pt}
          \usebeamercolor[bg]{column separator}\rule{1ex}{3em}
        \end{column}
        \begin{column}{\linewidth}
          \begin{beamercolorbox}[sep=12pt,left,#1]{section title in section page}
              \usebeamerfont{section title}\usebeamertemplate*{final text}\par
          \end{beamercolorbox}
        \end{column}
      \end{columns}
  \endgroup
}

\def\finalpage{\usebeamertemplate*{final page}\@thanks}

\mode<all>